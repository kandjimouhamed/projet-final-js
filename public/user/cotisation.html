<!doctype html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Bootstrap demo</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.2/dist/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-Zenh87qX5JnK2Jl0vWa8Ck2rdkQ2Bzep5IDxbcnCeuOxjzrPF/et3URy9Bv1WTRi" crossorigin="anonymous">
  <link rel="stylesheet" href="../src/styleCss/style.css">
</head>

<body>

  <div class="container">

    <div id="ajout_cotisation">

      <!-- Button trigger modal -->
      <button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#exampleModal">
        Ajout_Cotisation
      </button>

      <!-- Modal -->
      <div class="modal fade" id="exampleModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
        <div class="modal-dialog">
          <div class="modal-content">

            <div class="modal-body">
              <div class="row g-3">
                <div class="col">
                  <input type="mail" class="form-control" id="mail_membre" placeholder="mail_membre"
                    aria-label="montant_cotiser">
                </div>
                <div class="col">
                  <input type="date" class="form-control" placeholder="date_debut" id="date" aria-label="date_debut">
                </div>
                <div class="col">
                  <input type="number" class="form-control" id="cotiser" placeholder="montant_cotiser"
                    aria-label="montant_cotiser">
                </div>
              </div>
            </div>
            <div class="modal-footer">
              <button type="button" id="ajout_cotise" class="btn btn-secondary"
                data-bs-dismiss="modal">ajout_cotisation</button>
            </div>
          </div>
        </div>
      </div>

    </div>

    <div id="tableau" class="mb-3">
      <table class="table" id="table">
        <thead>
          <tr id="row" class="text-center rounded-1">
            <th scope="col">Membres</th>
            <th scope="col">Date début</th>
            <th scope="col">Montant cotisé</th>
            <th scope="col">Montant restant</th>
            <th scope="col">Actions</th>
          </tr>
        </thead>
        <tbody>

        </tbody>
      </table>
    </div>
  </div>
  <script src="https://kit.fontawesome.com/549a77ad41.js" crossorigin="anonymous"></script>
  <!-- MOR MBATHIE -->
  <script type="module">

    // Import the functions you need from the SDKs you need
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.13.0/firebase-app.js";
    import { getFirestore, query, where, collection, addDoc, getDocs, getDoc, doc, setDoc, updateDoc } from "https://www.gstatic.com/firebasejs/9.13.0/firebase-firestore.js";
    // TODO: Add SDKs for Firebase products that you want to use
    // https://firebase.google.com/docs/web/setup#available-libraries

    // Your web app's Firebase configuration
    const firebaseConfig = {
      apiKey: "AIzaSyDMdM55m1t8SCUyy8UoQuR4LX-HraDY3EM",
      authDomain: "bakeli-tontine.firebaseapp.com",
      projectId: "bakeli-tontine",
      storageBucket: "bakeli-tontine.appspot.com",
      messagingSenderId: "309665317631",
      appId: "1:309665317631:web:4a097fe3f5785040bf42ca"
    };

    // Initialize Firebase
    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    let ajout = document.getElementById('ajout_cotise');
    let debut_cotisation = document.getElementById('date');
    let montant_cotise = document.getElementById('cotiser')
    let mail_membre = document.getElementById('mail_membre')
    const tab = [];
   
    const seuil = 300000;
  
    let data;
    let recupereMail;
    const querySnapshot = await getDocs(collection(db, "membres"));
    querySnapshot.forEach((doc) => {
      data = doc.data()
      data.id = doc.id
      tab.push(data)  
    });
     // recuperer donnee
      console.log(tab);
    
      const memberId ="y0NzZlrJNH0zDNmAnOFz";
    ajout.addEventListener("click", ajouter)
    function ajouter(e) {
      e.preventDefault()
    const refmember =doc(db,"membres",memberId);
    updateDoc(refmember,{
      
        date_cotisation: debut_cotisation.value,
        Montant_cotise:montant_cotise.value
      
    })
    .then(function(){
      alert('donnee envoyer')
    })
    }

    const table = document.getElementById('table')
    tab.forEach(element => {
      table.innerHTML +=
        ` <tr> 
                                <td>${element.prenom}  ${element.name}</td>
                                 <td>${element.date_cotisation}</td>
                                 <td>${element.Montant_cotise}</td>
                                 <td>${seuil - element.Montant_cotise}</td>
                                <td><button style="border:none ${element.id} ;"><i class="fa-solid fa-eye"></i></button></td>
                             </tr> `
    });



  </script>


  <!-- MAIMOUNA DIOUF -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.2/dist/js/bootstrap.bundle.min.js"
    integrity="sha384-OERcA2EqjJCMA+/3y+gxIOqMEjwtxJY7qPCqsdltbNJuaOe923+mo//f6V8Qbsw3"
    crossorigin="anonymous"></script>

</body>

</html>